<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="leasecity.repo.commentRepo">
 	
 	<!-- 게시물 전체갯수 조회 -->
 	<select id="getCountAllComments" resultType="int">
 		SELECT COUNT(*) FROM comments;
 	</select>
 	
 	<!-- 게시물 페이지별 조회 -->
 	<select id="getPageSelectComment" parameterType="page" resultType="comment">
 		SELECT * 
 		FROM (
 				SELECT sub.*, rownum AS rnum
 				FROM( SELECT * FROM comments 
 					
 					
 					WHERE
 					
 					<choose>
 					<when test="#{}"></when>
 					<when test=""></when>
 					<otherwise></otherwise>
 					</choose>
 					
 					) sub
 				)
 		<if test="pageSize != null">
 		
 		</if>		
 	</select> 	
 	
 	
 	<!-- 게시물 추가 -->
 	<!-- comment_no는 TRIGGER로 AUTO_INCREMENT취급 받음 -->
 	<insert id="insertComment" parameterType="comment">
 		INSERT INTO comments 
 		(user_id, comment_title, 
 		comment_category, comment_content)
 		VALUES(#{userId}, #{commentTitle},
 		#{commentCategory},#{commentContent}) 
 	</insert>
 	
 	<!-- 게시물 삭제 - 종속성에 의해 댓글도 같이 자동삭제 -->
 	<delete id="deleteCommentAndReply" parameterType="comment">
 		DELETE FROM comments
 		WHERE comment_no = #{commentNo}
 	</delete>
 	
 	<!-- 게시물 수정 -->
 	<update id="updateComment" parameterType="comment">
 		UPDATE comments SET
 		comment_title = #{commentTitle},
 		comment_category = #{commentCategory},
 		comment_content = #{commentContent} 		
 		WHERE comment_no = #{commentNo}
 	</update>
 
 </mapper>